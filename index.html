<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertidor de Enlaces y Coordenadas de Mapas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Consistent light gray background */
        }
        #notification {
            transition: opacity 0.5s, transform 0.5s;
        }
        /* New tab styles inspired by the image */
        .tab {
            background-color: #f3f4f6; /* light-gray */
            color: #4b5563; /* gray-600 */
            border-color: transparent;
        }
        .dark .tab {
            background-color: #374151; /* gray-700 */
            color: #d1d5db; /* gray-300 */
        }
        .tab.active {
            background-color: #e0e7ff; /* indigo-100 */
            color: #4338ca; /* indigo-700 */
            border-color: #4338ca;
        }
        .dark .tab.active {
            background-color: #3730a3; /* indigo-800 */
            color: #e0e7ff; /* indigo-100 */
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="bg-slate-900 p-4 shadow-md">
        <div class="max-w-4xl mx-auto flex justify-center">
            <img src="https://dcdn-us.mitiendanube.com/stores/004/546/736/themes/common/logo-660776128-1736645739-9bb5db1715d3b799cdf782b0f0815d541736645739.webp?0" alt="Logo ArelyShop" class="h-12" onerror="this.onerror=null; this.src='https://placehold.co/200x50/0f172a/ffffff?text=ArelyShop';">
        </div>
    </header>

    <main class="flex-grow flex items-center justify-center p-4">
        <div class="w-full max-w-lg mx-auto p-6 sm:p-8 bg-white rounded-xl shadow-lg space-y-6 relative overflow-hidden">
            
            <div class="text-center">
                <h1 class="text-2xl font-bold text-gray-800">Conversor Universal de Mapas</h1>
                <p class="text-gray-500 mt-2">Busca un lugar, pega un enlace o introduce coordenadas para convertir.</p>
            </div>

            <!-- Search Bar -->
            <div class="space-y-2">
                <label for="searchInput" class="block text-sm font-medium text-gray-700">Buscar un Lugar</label>
                <div class="flex gap-2">
                    <input type="text" id="searchInput" placeholder="Ej: Plaza 24 de Septiembre, Santa Cruz" class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <button id="searchBtn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-colors duration-200 flex items-center justify-center w-24">
                        <span class="search-text">Buscar</span>
                        <div class="loader hidden"></div>
                    </button>
                </div>
            </div>

            <div class="relative flex py-2 items-center">
                <div class="flex-grow border-t border-gray-200"></div>
                <span class="flex-shrink mx-4 text-gray-400 text-sm">O usa</span>
                <div class="flex-grow border-t border-gray-200"></div>
            </div>


            <!-- Tabs -->
            <div class="flex border-b border-gray-200">
                <button id="tab-url" class="tab active flex-1 py-2 px-4 text-center font-medium border-b-2 transition-colors duration-200">Desde URL</button>
                <button id="tab-coords" class="tab flex-1 py-2 px-4 text-center font-medium border-b-2 transition-colors duration-200">Desde Coordenadas</button>
            </div>

            <!-- Input Forms -->
            <div class="space-y-4">
                <!-- URL Input -->
                <div id="content-url" class="tab-content active">
                    <label for="googleMapsUrl" class="block text-sm font-medium text-gray-700 mb-1">Enlace de Google Maps</label>
                    <input type="url" id="googleMapsUrl" placeholder="https://maps.app.goo.gl/..." class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <!-- Coordinates Input -->
                <div id="content-coords" class="tab-content">
                     <label for="coordsInput" class="block text-sm font-medium text-gray-700 mb-1">Coordenadas (Decimal o GMS)</label>
                    <input type="text" id="coordsInput" placeholder="Ej: 17°45'40.1&quot;S 63°10'13.1&quot;W" class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>

                <button id="convertBtn" class="w-full bg-gray-600 text-white font-semibold py-2.5 px-4 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-300 transition-colors duration-200">
                    Convertir desde Pestaña
                </button>
            </div>

            <!-- Results Section -->
            <div id="results" class="pt-4 space-y-3"></div>

            <!-- Error Message Box -->
            <div id="error-message" class="hidden p-4 bg-red-100 text-red-700 rounded-md">
                <p id="error-text"></p>
            </div>

            <!-- Notification for 'Copied' -->
            <div id="notification" class="absolute bottom-5 right-5 bg-gray-800 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transform translate-y-10">
                ¡Copiado!
            </div>

        </div>
    </main>

    <script>
        // --- DOM Elements ---
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const searchBtnText = document.querySelector('.search-text');
        const searchLoader = document.querySelector('.loader');
        const convertBtn = document.getElementById('convertBtn');
        const googleMapsUrlInput = document.getElementById('googleMapsUrl');
        const coordsInput = document.getElementById('coordsInput');
        const resultsDiv = document.getElementById('results');
        const errorMessageDiv = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const notificationDiv = document.getElementById('notification');
        const tabUrl = document.getElementById('tab-url');
        const tabCoords = document.getElementById('tab-coords');
        const contentUrl = document.getElementById('content-url');
        const contentCoords = document.getElementById('content-coords');

        let activeTab = 'url'; // 'url' or 'coords'

        // --- Event Listeners ---
        searchBtn.addEventListener('click', handleLocationSearch);
        searchInput.addEventListener('keypress', (e) => e.key === 'Enter' && handleLocationSearch());
        convertBtn.addEventListener('click', handleTabConversion);
        googleMapsUrlInput.addEventListener('keypress', (e) => e.key === 'Enter' && handleTabConversion());
        coordsInput.addEventListener('keypress', (e) => e.key === 'Enter' && handleTabConversion());
        
        googleMapsUrlInput.addEventListener('input', clearResults);
        coordsInput.addEventListener('input', clearResults);
        searchInput.addEventListener('input', clearResults);

        tabUrl.addEventListener('click', () => switchTab('url'));
        tabCoords.addEventListener('click', () => switchTab('coords'));

        /**
         * Handles search from the top search bar using Nominatim API.
         */
        async function handleLocationSearch() {
            const query = searchInput.value.trim();
            if (!query) return;

            clearResults();
            toggleSearchLoading(true);

            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();

                if (data && data.length > 0) {
                    const { lat, lon } = data[0];
                    generateLinks(lat, lon);
                } else {
                    showError('no-search-results');
                }
            } catch (error) {
                console.error("Search failed:", error);
                showError('search-failed');
            } finally {
                toggleSearchLoading(false);
            }
        }

        /**
         * Switches the active tab and content.
         * @param {string} tabName - The name of the tab to switch to ('url' or 'coords').
         */
        function switchTab(tabName) {
            activeTab = tabName;
            clearAllInputs();
            if (tabName === 'url') {
                tabUrl.classList.add('active');
                tabCoords.classList.remove('active');
                contentUrl.classList.add('active');
                contentCoords.classList.remove('active');
            } else {
                tabUrl.classList.remove('active');
                tabCoords.classList.add('active');
                contentUrl.classList.remove('active');
                contentCoords.classList.add('active');
            }
        }

        /**
         * Main function to handle the link/coordinate conversion process from tabs.
         */
        function handleTabConversion() {
            let coords = null;
            if (activeTab === 'url') {
                const url = googleMapsUrlInput.value.trim();
                if (!url) { clearResults(); return; }
                if (url.startsWith('https://maps.app.goo.gl')) {
                    showError('short-url', url);
                    return;
                }
                coords = extractCoordinatesFromUrl(url);
                if (!coords) showError('invalid-url');

            } else { // activeTab === 'coords'
                const coordString = coordsInput.value.trim();
                if (!coordString) { clearResults(); return; }
                coords = parseCoordinates(coordString);
                if (!coords) showError('invalid-coords');
            }

            if (coords) {
                hideError();
                generateLinks(coords.lat, coords.lon);
            }
        }

        /**
         * Parses a string to find coordinates, supporting Decimal and DMS formats.
         * @param {string} str - The coordinate string.
         * @returns {{lat: number, lon: number}|null}
         */
        function parseCoordinates(str) {
            let match = str.match(/^(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)$/);
            if (match) {
                return { lat: parseFloat(match[1]), lon: parseFloat(match[2]) };
            }
            const dmsRegex = /(\d+)[°\s]+(\d+)[',\s]+([\d.]+)"?\s*([NS])[, ]+(\d+)[°\s]+(\d+)[',\s]+([\d.]+)"?\s*([WE])/i;
            match = str.match(dmsRegex);
            if (match) {
                const [, latD, latM, latS, latDir, lonD, lonM, lonS, lonDir] = match;
                let lat = parseFloat(latD) + (parseFloat(latM) / 60) + (parseFloat(latS) / 3600);
                if (latDir.toUpperCase() === 'S') lat = -lat;
                let lon = parseFloat(lonD) + (parseFloat(lonM) / 60) + (parseFloat(lonS) / 3600);
                if (lonDir.toUpperCase() === 'W') lon = -lon;
                return { lat, lon };
            }
            return null;
        }

        /**
         * Extracts latitude and longitude from various Google Maps URL formats.
         * @param {string} url - The Google Maps URL.
         * @returns {{lat: number, lon: number}|null}
         */
        function extractCoordinatesFromUrl(url) {
            const patterns = [ /@(-?\d+\.\d+),(-?\d+\.\d+)/, /!3d(-?\d+\.\d+)!4d(-?\d+\.\d+)/, /ll=(-?\d+\.\d+),(-?\d+\.\d+)/, /search\/(-?\d+\.\d+),(-?\d+\.\d+)/, /query=(-?\d+\.\d*),(-?\d+\.\d*)/ ];
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match && match.length >= 3) {
                    return { lat: parseFloat(match[1]), lon: parseFloat(match[2]) };
                }
            }
            return null;
        }

        /**
         * Generates and displays the map links with copy buttons.
         * @param {number} lat - The latitude.
         * @param {number} lon - The longitude.
         */
        function generateLinks(lat, lon) {
            clearResults();
            const links = [
                { name: 'Waze', url: `https://waze.com/ul?ll=${lat},${lon}&navigate=yes`, color: 'bg-indigo-500 hover:bg-indigo-600', iconColor: 'text-indigo-500' },
                { name: 'Apple Maps', url: `http://maps.apple.com/?ll=${lat},${lon}&q=Ubicación`, color: 'bg-sky-500 hover:bg-sky-600', iconColor: 'text-sky-500' },
                { name: 'OpenStreetMap', url: `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}&zoom=16`, color: 'bg-emerald-500 hover:bg-emerald-600', iconColor: 'text-emerald-500' },
                { name: 'Geo Link (Móvil)', url: `geo:${lat},${lon}`, color: 'bg-gray-500 hover:bg-gray-600', iconColor: 'text-gray-500' }
            ];
            const fullIcons = {
                'Waze': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M14.61 4.416c-1.936-.55-3.953-.42-5.783.33a.75.75 0 00-.33 1.05c.3.56.96.78 1.52.48 1.3-.36 2.68-.42 3.99-.12a.75.75 0 00.6-.94zm-10.22 6.54c.24-1.8 1.14-3.45 2.5-4.74a.75.75 0 00-1.05-1.05c-1.56 1.48-2.61 3.42-2.91 5.61a.75.75 0 00.75.87c.4-.03.72-.36.69-.75l-.03-.2a.75.75 0 00-.03-.2zm7.62 9.294c1.82.51 3.73.48 5.49-.09a.75.75 0 00.45-1.11c-.39-.52-1.08-.66-1.62-.33-1.29.33-2.61.39-3.87.12a.75.75 0 00-.69.99c.06.33.27.6.54.42zm-1.6-6.264a3 3 0 116 0 3 3 0 01-6 0zm-1.5-3a4.5 4.5 0 109 0 4.5 4.5 0 00-9 0z"></path></svg>`,
                'Apple Maps': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12.01 2.011c-4.29 0-7.93 3.3-8.01 7.59v.01c0 4.3 3.71 7.83 8 7.83s8-3.54 8-7.83v-.01c-.07-4.29-3.71-7.59-7.99-7.59zm-4.3 7.59c0-2.37 1.93-4.3 4.3-4.3s4.3 1.93 4.3 4.3c0 2.36-1.93 4.3-4.3 4.3s-4.3-1.93-4.3-4.3zm10.3 5.43l-2.11 2.12c-.2.2-.45.29-.71.29s-.51-.1-.71-.29l-1.42-1.42-1.42 1.42c-.2.2-.45.29-.71.29s-.51-.1-.71-.29l-2.11-2.12c-1.31.76-2.29 2.04-2.29 3.54v.01c0 .06 0 .12.01.17h16.98c0-.06.01-.11.01-.17v-.01c0-1.5-1-2.78-2.29-3.54z"></path></svg>`,
                'OpenStreetMap': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2c-4.418 0-8 3.582-8 8 0 4.419 8 14 8 14s8-9.581 8-14c0-4.418-3.582-8-8-8zm0 11.5c-1.933 0-3.5-1.567-3.5-3.5s1.567-3.5 3.5-3.5 3.5 1.567 3.5 3.5-1.567 3.5-3.5 3.5z"></path></svg>`,
                'Geo Link (Móvil)': `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></svg>`
            };

            const resultsTitle = document.createElement('h3');
            resultsTitle.className = "text-lg font-semibold text-gray-700";
            resultsTitle.textContent = "Abrir con:";
            resultsDiv.appendChild(resultsTitle);

            links.forEach(link => {
                const rowContainer = document.createElement('div');
                rowContainer.className = 'flex items-center justify-between p-2 rounded-lg bg-gray-50';
                const nameContainer = document.createElement('div');
                nameContainer.className = 'flex items-center gap-3';
                const iconSpan = document.createElement('span');
                iconSpan.innerHTML = fullIcons[link.name];
                iconSpan.className = `flex items-center justify-center w-8 h-8 ${link.iconColor}`;
                const nameSpan = document.createElement('span');
                nameSpan.textContent = link.name;
                nameSpan.className = 'font-medium text-gray-700';
                nameContainer.appendChild(iconSpan);
                nameContainer.appendChild(nameSpan);
                const buttonsContainer = document.createElement('div');
                buttonsContainer.className = 'flex items-center gap-2';
                const goButton = document.createElement('a');
                goButton.href = link.url;
                if (!link.url.startsWith('intent:')) { goButton.target = '_blank'; }
                goButton.rel = 'noopener noreferrer';
                goButton.className = 'px-4 py-1.5 text-sm font-semibold text-white rounded-md shadow-sm transition-colors duration-200 ' + link.color;
                goButton.textContent = 'Ir';
                goButton.addEventListener('click', (e) => { copyToClipboard(link.url); });
                const copyButton = document.createElement('button');
                copyButton.title = 'Copiar enlace';
                copyButton.className = 'p-1.5 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors';
                copyButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
                copyButton.onclick = (e) => { e.preventDefault(); copyToClipboard(link.url); };
                buttonsContainer.appendChild(goButton);
                buttonsContainer.appendChild(copyButton);
                rowContainer.appendChild(nameContainer);
                rowContainer.appendChild(buttonsContainer);
                resultsDiv.appendChild(rowContainer);
            });
        }
        
        function copyToClipboard(text) {
            const ta = document.createElement('textarea');
            ta.value = text;
            ta.style.position = 'fixed'; ta.style.opacity = '0';
            document.body.appendChild(ta);
            ta.select();
            try {
                document.execCommand('copy');
                showNotification();
            } catch (err) { console.error('No se pudo copiar el texto: ', err); }
            document.body.removeChild(ta);
        }

        function showNotification() {
            notificationDiv.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => {
                notificationDiv.classList.add('opacity-0', 'translate-y-10');
            }, 2000);
        }

        function clearAllInputs() {
            googleMapsUrlInput.value = '';
            coordsInput.value = '';
            searchInput.value = '';
            clearResults();
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
            hideError();
        }

        function toggleSearchLoading(isLoading) {
            if (isLoading) {
                searchBtnText.classList.add('hidden');
                searchLoader.classList.remove('hidden');
                searchBtn.disabled = true;
            } else {
                searchBtnText.classList.remove('hidden');
                searchLoader.classList.add('hidden');
                searchBtn.disabled = false;
            }
        }

        function showError(type, data = '') {
            resultsDiv.innerHTML = '';
            let msg = '';
            switch (type) {
                case 'short-url':
                    msg = `<strong>¡Enlace corto detectado!</strong> No se puede procesar directamente.<br><br><strong>Solución:</strong><br>1. <a href="${data}" target="_blank" rel="noopener noreferrer" class="font-bold underline text-blue-500">Haz clic aquí para abrirlo</a>.<br>2. Copia la nueva URL (larga) de tu navegador.<br>3. Pégala aquí y convierte de nuevo.`;
                    break;
                case 'invalid-url':
                    msg = '<strong>¡URL no válida!</strong> No pudimos encontrar coordenadas. Asegúrate de que sea un enlace de Google Maps. Si estás pegando coordenadas (ej: 17°S 63°W), por favor usa la pestaña "Desde Coordenadas".';
                    break;
                case 'invalid-coords':
                    msg = '<strong>¡Coordenadas no válidas!</strong> Usa un formato como "40.71, -74.00" o "40°42\'46\\"N 74°00\'21\\"W".';
                    break;
                case 'no-search-results':
                    msg = '<strong>No se encontraron resultados.</strong> Por favor, intenta con una búsqueda más específica.';
                    break;
                case 'search-failed':
                    msg = '<strong>La búsqueda falló.</strong> Por favor, revisa tu conexión a internet e inténtalo de nuevo.';
                    break;
            }
            errorText.innerHTML = msg;
            errorMessageDiv.classList.remove('hidden');
        }

        function hideError() {
            errorMessageDiv.classList.add('hidden');
        }
    </script>

</body>
</html>
